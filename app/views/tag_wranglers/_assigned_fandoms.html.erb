<span id="assigned-fandoms">
  <% if @fandoms.empty? %>
    <p><%= ts("Your lack of fandoms makes the wrangulator sad. Fandoms can be assigned via the") %> <%= link_to ts('tag wranglers page'), tag_wranglers_path %>.</p>
  <% else %>
    <% allowed_delete = logged_in_as_admin? || current_user == @wrangler %>
    <%= form_tag tag_wrangler_path(:id => @wrangler), :method => :delete, remote: true, authenticity_token: true do %>
      <p><%= ts('Fandoms assigned to you via the ') %> <%= link_to ts('tag wranglers page'), tag_wranglers_path %>. <%= ts('The unwrangled count is the number of unwrangled tags which were used on works in the given fandom.') %></p>
      <table summary="<%= ts('Overview of your assigned fandoms and how many unfilterable and unwrangled tags belong to each assigned fandom.') %>">
        <caption><%= ts('Unfilterable and Unwrangled Tag Counts for Your Assigned Fandoms') %></caption>
        <thead>
        <tr>
          <th rowspan="2" colspan="<%= allowed_delete ? 2 : 1 %>" scope="col"><%= ts('Fandom') %></th>
          <th colspan="3" scope="col"><%= ts('Unfilterable') %></th>
          <th colspan="3" scope="col"><%= ts('Unwrangled') %></th>
        </tr>
        <tr>
          <th scope="col"><%= ts('Characters') %></th>
          <th scope="col"><%= ts('Relationships') %></th>
          <th scope="col"><%= ts('Freeforms') %></th>
          <th scope="col"><%= ts('Characters') %></th>
          <th scope="col"><%= ts('Relationships') %></th>
          <th scope="col"><%= ts('Freeforms') %></th>
        </tr>
        </thead>
        <tbody>
        <% @fandoms.each do |fandom| %>
          <tr>
            <% if allowed_delete %>
              <th scope="row"><%= check_box_tag "fandom_ids[]", fandom.id, false, id: "fandom_ids_#{fandom.id}" %></th>
            <% end %>
            <th scope="row" title="<%= ts('fandom') %>"><%= link_to fandom.name, {:controller => :tags, :action => :wrangle, :id => fandom} %></th>
            <td title="<%= ts('unfilterable characters') %>"><%= (tag_count = fandom.characters.unfilterable.size) > 0 ? link_to(tag_count, {:controller => :tags, :action => :wrangle, :id => fandom, :show => :characters, :status => :unfilterable}) : " " %></td>
            <td title="<%= ts('unfilterable relationships') %>"><%= (tag_count = fandom.relationships.unfilterable.size) > 0 ? link_to(tag_count, {:controller => :tags, :action => :wrangle, :id => fandom, :show => :relationships, :status => :unfilterable}) : " " %></td>
            <td title="<%= ts('unfilterable freeforms') %>"><%= (tag_count = fandom.freeforms.unfilterable.size) > 0 ? link_to(tag_count, {:controller => :tags, :action => :wrangle, :id => fandom, :show => :freeforms, :status => :unfilterable}) : " " %></td>
            <td title="<%= ts('unwrangled characters') %>"><%= (tag_count = fandom.same_work_tags.unwrangled.by_type("Character").distinct.size) > 0 ? link_to(tag_count, {:controller => :tags, :action => :wrangle, :id => fandom, :show => :characters, :status => :unwrangled}) : " " %></td>
            <td title="<%= ts('unwrangled relationships') %>"><%= (tag_count = fandom.same_work_tags.unwrangled.by_type("Relationship").distinct.size) > 0 ? link_to(tag_count, {:controller => :tags, :action => :wrangle, :id => fandom, :show => :relationships, :status => :unwrangled}) : " " %></td>
            <td title="<%= ts('unwrangled freeforms') %>"><%= (tag_count = fandom.same_work_tags.unwrangled.by_type("Freeform").distinct.size) > 0 ? link_to(tag_count, {:controller => :tags, :action => :wrangle, :id => fandom, :show => :freeforms, :status => :unwrangled}) : " " %></td>
          </tr>
        <% end %>
        </tbody>
      </table>

      <% if allowed_delete %>
        <fieldset>
          <legend>Actions</legend>
          <p class="submit">
            <input type="submit" value="Unassign" name="commit" class="confirm_delete" data-confirm="<%= ts('Are you sure you want to unassign these fandoms?') %>">
          </p>
        </fieldset>
      <% end %>
    <% end %>
  <% end %>
</span>
